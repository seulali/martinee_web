<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Martinee</title>
    <link rel="stylesheet" href="index.css" />
    <script type="text/javascript">
        (function (e, t) {
            var n = e.amplitude || { _q: [], _iq: {} }; var r = t.createElement("script")
                ; r.type = "text/javascript"
                ; r.integrity = "sha384-+EO59vL/X7v6VE2s6/F4HxfHlK0nDUVWKVg8K9oUlvffAeeaShVBmbORTC2D3UF+"
                ; r.crossOrigin = "anonymous"; r.async = true
                ; r.src = "https://cdn.amplitude.com/libs/amplitude-8.17.0-min.gz.js"
                ; r.onload = function () {
                    if (!e.amplitude.runQueuedFunctions) {
                        console.log("[Amplitude] Error: could not load SDK")
                    }
                }
                ; var i = t.getElementsByTagName("script")[0]; i.parentNode.insertBefore(r, i)
                ; function s(e, t) {
                    e.prototype[t] = function () {
                        this._q.push([t].concat(Array.prototype.slice.call(arguments, 0))); return this
                    }
                }
            var o = function () { this._q = []; return this }
                ; var a = ["add", "append", "clearAll", "prepend", "set", "setOnce", "unset", "preInsert", "postInsert", "remove"]
                ; for (var c = 0; c < a.length; c++) { s(o, a[c]) } n.Identify = o; var u = function () {
                    this._q = []
                    ; return this
                }
                ; var l = ["setProductId", "setQuantity", "setPrice", "setRevenueType", "setEventProperties"]
                ; for (var p = 0; p < l.length; p++) { s(u, l[p]) } n.Revenue = u
                ; var d = ["init", "logEvent", "logRevenue", "setUserId", "setUserProperties", "setOptOut", "setVersionName", "setDomain", "setDeviceId", "enableTracking", "setGlobalUserProperties", "identify", "clearUserProperties", "setGroup", "logRevenueV2", "regenerateDeviceId", "groupIdentify", "onInit", "logEventWithTimestamp", "logEventWithGroups", "setSessionId", "resetSessionId"]
                ; function v(e) {
                    function t(t) {
                        e[t] = function () {
                            e._q.push([t].concat(Array.prototype.slice.call(arguments, 0)))
                        }
                    }
                    for (var n = 0; n < d.length; n++) { t(d[n]) }
                } v(n); n.getInstance = function (e) {
                    e = (!e || e.length === 0 ? "$default_instance" : e).toLowerCase()
                        ; if (!Object.prototype.hasOwnProperty.call(n._iq, e)) {
                            n._iq[e] = { _q: [] }; v(n._iq[e])
                        } return n._iq[e]
                }; e.amplitude = n
        })(window, document);
    </script>
    <script>
        var userId = "molly";
        amplitude.getInstance().init("2d45e9d9ac9ee26cbd38f9df620467aa", userId, {includeUtm: true, includeReferrer: true},
        function(){ alert('초기화 완료'); });
    </script>
    <script>
        new amplitude.Identify(); // does nothing, must call one of the following methods and pass to client
        var identify = new amplitude.Identify();
        var identify1 = new amplitude.Identify().set('Age', '30');
        var identify2 = new amplitude.Identify().set('Hobby', 'knitting').set('City', 'seoul');
        amplitude.getInstance().identify(identify1);
        amplitude.getInstance().identify(identify2);
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
</head>

<body style="background-color: #0e0909;">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>


    <!-- 상단 헤더 바 -->
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <img src="https://cdn-icons-png.flaticon.com/512/920/920707.png" width="30" height="30"
                class="d-inline-block align-top" alt="" loading="lazy">
            Martinee Space
        </a>
    </nav>
    <!-- 중앙 메인 컴포넌트 -->
    <div class="container">
        <div class="jumbotron" id="jumbotron">
            <h1 class="display-4" id="display-4">&#128150 마티니 샘플 웹사이트에 오신 걸 환영합니다 &#128150</h1>
            <p class="lead" id="lead">Amplitude SDK UTM 파라미터 샘플웹입니다</p>
            <hr class="my-4">
            <a class="btn btn-warning btn-lg calltoapi" id="clickbtn" href="#" role="button"
                onclick="amplitude.getInstance().logEvent('button_clicked')">클릭 이벤트</a>
        </div>


        <!-- 카드 레이아웃 -->
        <div class="row row-cols-1 row-cols-md-3" id="movie-list">
            <div class="col mb-4">
                <div class="card">
                    <img src="..." class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <button type="button" class="btn btn-success" id="review-button" onclick="review()">
                            리뷰 보기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Modal component html -->
    <div class="modal" id="review-modal" tabindex="-1">
        // 모달에 ID 부여
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">후기</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>불라불라</p>
                </div>
                <div class="modal-footer">
                    <input type="text" class="form-control" id="review" style="width: 70%;" />
                    <button type="button" class="btn btn-primary" onclick="addReview()">후기 작성 완료</button>
                </div>
            </div>
        </div>
    </div>

    <script>

        // 가장 먼저 실행되는 함수 & 영화 데이터 API 호출

        $(document).ready(function () {
            console.log("시작")
            $.ajax({
                type: "GET",
                url: "https://api.themoviedb.org/3/movie/popular?api_key=55f601e1cb53af3472f9e513de2eb480&page=1",
                data: {
                    "key": "value"
                },
                success: function (json) {
                    console.log(json)
                    $('#movie-list').html('') // 기존에 있던 데이터 제거
                    let movie_list = json.results // 문자열을 객체화

                    // 받아 온 20개의 영화 데이터를 html 태그 변수로 저장하고, 카드 리스트에 붙여주는 작업을 20번하기 위해 반복문으로 처리

                    for (let i = 0; i < movie_list.length; i++) {
                        let card = `<div class="col mb-4">
        <div class="card">
            <img src="${'https://image.tmdb.org/t/p/w500' + movie_list[i].backdrop_path}" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">${movie_list[i].title}</h5>
                <button type="button" class="btn btn-success" id="review-button" onclick="review(${movie_list[i].id})">
                    리뷰 보기</button>
            </div>
        </div>`
                        $("#movie-list").append(card)


                        // API check 함수 정의

                    }
                },
                error: function (err) {

                }
            })
        })

        function review(id) {
            $.ajax({
                url: `https://api.themoviedb.org/3/movie/${id}/reviews?api_key=55f601e1cb53af3472f9e513de2eb480&language=en-US&page=1`, // 백틱으로 처리
                data: {},
                type: "GET",
                success: function (json) {
                    console.log(json)
                    $(".modal-body").html('')
                    let reviews = json.results
                    console.log(reviews)

                    for (i = 0; i < reviews.length; i++) {
                        $(".modal-body").append(`<p>${reviews[i].content}</p>`)

                    }
                }
            })

            $('#review-modal').modal('show') // jquery
        }

    </script>

</body>

</html>